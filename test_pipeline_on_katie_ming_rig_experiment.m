experiment_relative_path = 'FlyBowlOpto/SS36564_20XUAS_CsChrimson_mVenus_attP18_flyBowlMing_20200227_Continuous_2min_5int_20200107_20200229T132141' ;

[~, experiment_name] = fileparts2(experiment_relative_path) ;
working_copy_example_experiment_folder_path = reset_goldblum_example_experiments_working_copy_folder() ;
experiment_folder_path = fullfile(working_copy_example_experiment_folder_path, experiment_relative_path) ;
this_script_file_path = mfilename('fullpath') ;
this_script_folder_path = fileparts(this_script_file_path) ;
settings_folder_path = fullfile(this_script_folder_path, 'settings') ;

% Read the experiment metadata to determine the analysis_protoocol
metadata_file_path = determine_metadata_file_path(experiment_folder_path) ;
analysis_protocol_folder_name = analysis_protocol_from_metadata_file(metadata_file_path, settings_folder_path) ;
%fprintf('Analysis protocol is: %s\n', analysis_protocol_folder_name) ;

% Build up the parameters cell array
params = ...
    {'settingsdir',settings_folder_path,...
     'analysis_protocol',analysis_protocol_folder_name, ...
     'forcecompute',false,...
     'doautomaticchecksincoming',true,...
     'doflytracking',true,...
     'doregistration',true,...
     'doledonoffdetection',true,...
     'dotrackwings',true,...
     'dosexclassification',true,...
     'docomputeperframefeatures',true,...
     'docomputehoghofperframefeatures',false,...
     'dojaabadetect',true,...
     'docomputeperframestats',false,...
     'doplotperframestats',false,...
     'domakectraxresultsmovie',false,...
     'doextradiagnostics',false,...
     'doanalysisprotocol',isunix(),...
     'doautomaticcheckscomplete',false } ;

% Call the function to do the real work
[success, msgs, stage] = FlyDiscoPipeline(experiment_folder_path, params{:}) ;

% Error out if not success
if ~success ,
    fprintf('FlyDiscoPipeline() encountered some problems(s), maybe at stage %s:\n', stage)
    for i = 1 : length(msgs) ,
        msg = msgs{i} ;
        fprintf('%s\n', msg) ;
    end
    error('FlyDiscoPipeline() failed!') ;
end
